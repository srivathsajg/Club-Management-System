<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Club Management System{% endblock %}</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <!-- Custom CSS -->
    {% load static %} {% load widget_tweaks %}
    <link rel="stylesheet" href="{% static 'css/main.css' %}" />
    <link rel="stylesheet" href="{% static 'css/dark-mode.css' %}" />
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    {% block extra_css %}{% endblock %}
    
    <!-- Dark Mode Toggle JS -->
    <script>
      // Set initial theme based on saved preference or system preference
      const savedTheme = localStorage.getItem('theme');
      const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      
      if (savedTheme) {
        document.documentElement.setAttribute('data-bs-theme', savedTheme);
      } else if (systemPrefersDark) {
        document.documentElement.setAttribute('data-bs-theme', 'dark');
        localStorage.setItem('theme', 'dark');
      } else {
        document.documentElement.setAttribute('data-bs-theme', 'light');
        localStorage.setItem('theme', 'light');
      }
      
      function toggleDarkMode() {
        const currentTheme = document.documentElement.getAttribute('data-bs-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        document.documentElement.setAttribute('data-bs-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        
        const themeIcon = document.getElementById('theme-icon');
        if (themeIcon) {
          if (newTheme === 'dark') {
            themeIcon.classList.remove('fa-moon');
            themeIcon.classList.add('fa-sun');
            themeIcon.title = 'Switch to Light Mode';
          } else {
            themeIcon.classList.remove('fa-sun');
            themeIcon.classList.add('fa-moon');
            themeIcon.title = 'Switch to Dark Mode';
          }
        }
      }
    </script>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container">
        <a class="navbar-brand" href="{% url 'home' %}">CLUB MATRIX</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            {% if user.is_authenticated %}
            <li class="nav-item">
              <a class="nav-link" href="{% url 'home' %}">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'club_list' %}">Clubs</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'upcoming_events' %}">Events</a>
            </li>
            {% if user.userprofile.role == 'admin' %}
            <li class="nav-item">
              <a class="nav-link" href="{% url 'admin_dashboard' %}"
                >Admin Dashboard</a
              >
            </li>
            {% endif %} {% endif %}
          </ul>

          <!-- Global Search Form -->
          {% if user.is_authenticated %}
          <form
            class="d-flex mx-auto"
            style="width: 40%"
            action="{% url 'global_search' %}"
            method="get"
          >
            <div class="input-group">
              <input
                class="form-control"
                type="search"
                name="q"
                placeholder="Search for clubs or events"
                aria-label="Search"
              />
              <button
                class="btn"
                type="submit"
                style="background-color: #fd7e14; color: white"
              >
                <i class="fas fa-search"></i>
              </button>
            </div>
          </form>
          {% endif %}
          <ul class="navbar-nav">
            <!-- Dark Mode Toggle -->
            <li class="nav-item me-2">
              <button onclick="toggleDarkMode()" class="btn btn-outline-light btn-sm mt-1">
                <i id="theme-icon" class="fas fa-moon"></i>
              </button>
            </li>
            {% if user.is_authenticated %}
            <li class="nav-item dropdown" style="z-index: 1050;">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdown"
                role="button"
                data-bs-toggle="dropdown"
              >
                {{ user.username }}
              </a>
              <ul class="dropdown-menu dropdown-menu-end" style="z-index: 1050;">
                <li>
                  <a class="dropdown-item" href="{% url 'profile' %}"
                    >Profile</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="{% url 'logout' %}">Logout</a>
                </li>
              </ul>
            </li>
            {% else %}
            <li class="nav-item">
              <a class="nav-link" href="{% url 'login' %}">Login</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{% url 'register' %}">Register</a>
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <!-- Messages -->
    <div class="container mt-3">
      {% if messages %} {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
        {{ message }}
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
        ></button>
      </div>
      {% endfor %} {% endif %}
    </div>

    <!-- Main Content -->
    <div class="container mt-4">
      {% block content %}
      {% endblock %}
    </div>

    <!-- Footer -->
    <footer class="bg-dark py-4 mt-5">
      <div class="container">
        <div class="row">
          <div class="col-md-6 mb-3 mb-md-0">
            <h5 class="footer-title">About Us</h5>
            <p class="footer-text">
              Join our vibrant community of clubs and unleash your potential.
              Connect, collaborate, and create memorable experiences with
              like-minded individuals!
            </p>
            <h5 class="footer-title"><i class="fas fa-users me-2"></i>Our Team :</h5>
            <p class="footer-text">
              <i class="fas fa-user me-2"></i>
              Srivathsa JG<br />

              <i class="fas fa-user me-2"></i>
              Sharavana HS <br />

              <i class="fas fa-user me-2"></i>
              Suyog
            </p>
          </div>

          <div class="col-md-6 text-md-end">
            <h5 class="footer-title">Get In Touch!</h5>
            <p class="footer-text">
              <i class="fas fa-envelope me-2"></i>
              srivathsasrivathsa59@gmail.com<br>
            
              <i class="fas fa-phone me-2"></i> 9019792834
            </p>
            <p class="footer-text">
              <i class="fas fa-map-marker-alt me-2"></i>
              Address :<br />
              Club Matrix ,<br />
              Dept of CS&E ,<br />
              AIT ,Chikkamagaluru-577102
            </p>
          </div>
        </div>
        <hr class="my-3 footer-divider" />
        <div class="text-center">
          <p class="footer-copyright">Â© 2025 Club Management System</p>
        </div>
      </div>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Motivational Statements JS -->
    {% load static %}
    <script src="{% static 'js/motivational.js' %}"></script>

    <!-- Custom JavaScript for Search Functionality -->
    <script>
      // Safely add event listeners only if elements exist
      function initSearchFunctionality() {
        // Get the search input element
        const searchInput = document.querySelector(
          '.input-group input[type="search"]'
        );
        
        if (!searchInput) return; // Exit if search input doesn't exist

        // Get the hidden input fields for the search forms
        const clubSearchQuery = document.getElementById("club-search-query");
        const eventSearchQuery = document.getElementById("event-search-query");
        
        // Get the dropdown items
        const clubSearchLink = document.querySelector(
          "a[onclick=\"document.getElementById('club-search-form').submit();\"]" 
        );
        
        const eventSearchLink = document.querySelector(
          "a[onclick=\"document.getElementById('event-search-form').submit();\"]" 
        );

        // Add event listeners only if elements exist
        if (clubSearchLink && clubSearchQuery) {
          clubSearchLink.addEventListener("click", function (e) {
            e.preventDefault();
            clubSearchQuery.value = searchInput.value;
            document.getElementById("club-search-form").submit();
          });
        }

        if (eventSearchLink && eventSearchQuery) {
          eventSearchLink.addEventListener("click", function (e) {
            e.preventDefault();
            eventSearchQuery.value = searchInput.value;
            document.getElementById("event-search-form").submit();
          });
        }
      }
      
      // Execute when DOM is fully loaded
      if (document.readyState === 'loading') {
        document.addEventListener("DOMContentLoaded", initSearchFunctionality);
      } else {
        // DOM already loaded
        initSearchFunctionality();
      }
    </script>


    
    <!-- Custom JS -->
    {% block extra_js %}
    <script>
        $(document).ready(function() {
            var currentUrl = window.location.pathname;
            $('.navbar-nav .nav-item').each(function() {
                var link = $(this).find('.nav-link').attr('href');
                if (currentUrl === link) {
                    $(this).addClass('active');
                }
            });
        });
    </script>
{% endblock %}
  </body>

  <style>
    /* Footer Fog White Styles */
    .footer-title {
      color: #f0f0f0;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .footer-text {
      color: #f0f0f0;
      font-size: 0.95rem;
      line-height: 1.6;
      margin-bottom: 1rem;
    }

    .footer-text i {
      color: #d0d0d0;
      transition: color 0.3s ease;
    }

    .footer-text i:hover {
      color: #f0f0f0;
    }

    .footer-divider {
      background: linear-gradient(90deg, transparent, #f0f0f0, transparent);
      height: 1px;
      border: none;
      margin: 2rem 0;
    }

    .footer-copyright {
      color: #f0f0f0;
      font-size: 0.9rem;
      margin-bottom: 0;
      opacity: 0.9;
    }

    /* Enhanced footer background */
    footer.bg-dark {
      background: linear-gradient(135deg, #1a1a1a, #2d2d2d) !important;
      border-top: 1px solid #333;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .footer-text {
        font-size: 0.9rem;
      }
      
      .footer-title {
        font-size: 1.1rem;
      }
    }
  </style>
</html>
