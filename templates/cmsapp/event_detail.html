{% extends 'cmsapp/base.html' %} {% block content %}
<div class="container mt-4">
  <div class="row">
    <div class="col-md-8 offset-md-2">
      <div class="card">
        <div
          class="card-header bg-primary text-white d-flex justify-content-between align-items-center"
        >
          <h4>{{ event.title }} {% if event.is_closed %}<span class="badge bg-danger">Event Ended</span>{% endif %}</h4>
          <div>
            {% if not event.is_closed %}
              {% if is_leader or is_creator or role == 'admin' %}
              <a
                href="{% url 'event_update' event.id %}"
                class="btn btn-sm btn-light me-2"
              >
                <i class="fas fa-edit"></i> Edit
              </a>
              <a
                href="{% url 'event_delete' event.id %}"
                class="btn btn-sm btn-danger"
              >
                <i class="fas fa-trash"></i> Delete
              </a>
              {% endif %}
            {% endif %}
          </div>
        </div>

        {% if event.image %}
        <img
          src="{{ event.image.url }}"
          class="card-img-top"
          alt="{{ event.title }}"
          style="max-height: 300px; object-fit: cover"
        />
        {% endif %}

        <div class="card-body">
          <div class="row mb-4">
            <div class="col-md-6">
              <h5><i class="fas fa-calendar-alt"></i> Date & Time</h5>
              <p>Starts: {{ event.start_date|date:"F j, Y, g:i a" }}</p>
              <p>Ends: {{ event.end_date|date:"F j, Y, g:i a" }}</p>
            </div>
            <div class="col-md-6">
              <h5><i class="fas fa-map-marker-alt"></i> Location</h5>
              <p>{{ event.location }}</p>
            </div>
          </div>

          <div class="mb-4">
            <h5><i class="fas fa-info-circle"></i> Description</h5>
            <p>{{ event.description }}</p>
          </div>

          <div class="mb-4">
            <h5><i class="fas fa-users"></i> Organized by</h5>
            <p>{{ event.club.name }}</p>
            <a
              href="{% url 'club_detail' event.club.id %}"
              class="btn btn-outline-primary btn-sm"
            >
              <i class="fas fa-arrow-left"></i> Back to Club
            </a>
          </div>

          <div class="text-muted">
            <small>Created on {{ event.created_at|date:"F j, Y" }}</small>
          </div>
        </div>
      </div>
      
      <!-- Registration Form -->
      {% if user.is_authenticated and not is_creator and not role == 'admin' %}
      <div class="card mt-4">
        <div class="card-header bg-success text-white">
          <h5><i class="fas fa-edit"></i> Register for this Event</h5>
        </div>
        <div class="card-body">
          <form method="post" action="{% url 'register_for_event' event.id %}">
                {% csrf_token %}
                
                <!-- Registration Type -->
                <div class="form-group">
                    <label><strong>Registration Type:</strong></label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="registration_type" id="individual" value="individual" checked>
                        <label class="form-check-label" for="individual">Individual</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="registration_type" id="team" value="team">
                        <label class="form-check-label" for="team">Team</label>
                    </div>
                </div>

                <!-- Team Fields (Conditional) -->
                <div id="team-fields" style="display: none;">
                    <div class="form-group">
                        <label for="team_name"><strong>Team Name:</strong></label>
                        <input type="text" class="form-control" id="team_name" name="team_name">
                    </div>
                    <div class="form-group">
                        <label for="team_members"><strong>Team Members (comma-separated emails):</strong></label>
                        <input type="text" class="form-control" id="team_members" name="team_members">
                    </div>
                </div>

                <button type="submit" class="btn btn-success">Register</button>
            </form> <i class="fas fa-check"></i> Register
            </button>
          </form>
        </div>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Registered Members Section -->
  {% if is_leader or is_creator or role == 'admin' %}
  <div class="row mt-4">
    <div class="col-md-8 offset-md-2">
      <div class="card">
        <div class="card-header bg-secondary text-white">
          <h5><i class="fas fa-users"></i> Registered Members</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>SL No</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Team/Individual</th>
                </tr>
              </thead>
              <tbody>
                {% for participant in registered_participants %}
                <tr>
                  <td>{{ forloop.counter }}</td>
                  <td>{{ participant.get_full_name|default:participant.username }}</td>
                  <td>{{ participant.email }}</td>
                  <td>Individual</td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="4" class="text-center text-muted">No registered members yet</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const individualRadio = document.getElementById('individual');
        const teamRadio = document.getElementById('team');
        const teamFields = document.getElementById('team-fields');

        function toggleTeamFields() {
            if (teamRadio.checked) {
                teamFields.style.display = 'block';
            } else {
                teamFields.style.display = 'none';
            }
        }

        individualRadio.addEventListener('change', toggleTeamFields);
        teamRadio.addEventListener('change', toggleTeamFields);

        // Initial check
        toggleTeamFields();
    });
</script>
{% endblock %}
